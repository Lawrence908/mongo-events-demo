<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Events Demo</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center my-4">MongoDB Events Demo</h1>
                <p class="text-center text-muted">Demonstrating MongoDB features: CRUD, Text Search, Geospatial, Analytics, Performance, and Transactions</p>
            </div>
        </div>

        <!-- Database Switch -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Database Configuration</h5>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary" id="local-db-btn">Local MongoDB</button>
                            <button type="button" class="btn btn-outline-success" id="cloud-db-btn">Cloud Atlas</button>
                        </div>
                        <small class="text-muted ms-3">Current: <span id="current-db">Local MongoDB</span></small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Tabs -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="crud-tab" data-bs-toggle="tab" data-bs-target="#crud" type="button" role="tab">
                    CRUD Lab
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="search-tab" data-bs-toggle="tab" data-bs-target="#search" type="button" role="tab">
                    Text Search
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="nearby-tab" data-bs-toggle="tab" data-bs-target="#nearby" type="button" role="tab">
                    Nearby (Geo)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab">
                    Analytics
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="perf-tab" data-bs-toggle="tab" data-bs-target="#perf" type="button" role="tab">
                    Performance
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="txn-tab" data-bs-toggle="tab" data-bs-target="#txn" type="button" role="tab">
                    Transactions
                </button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabsContent">
            <!-- CRUD Lab Tab -->
            <div class="tab-pane fade show active" id="crud" role="tabpanel">
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Create Event</h5>
                            </div>
                            <div class="card-body">
                                <form id="create-event-form">
                                    <div class="mb-3">
                                        <label for="event-title" class="form-label">Title</label>
                                        <input type="text" class="form-control" id="event-title" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="event-description" class="form-label">Description</label>
                                        <textarea class="form-control" id="event-description" rows="3"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="event-tags" class="form-label">Tags (comma-separated)</label>
                                        <input type="text" class="form-control" id="event-tags" placeholder="music, tech, business">
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="event-lng" class="form-label">Longitude</label>
                                            <input type="number" class="form-control" id="event-lng" step="0.000001" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="event-lat" class="form-label">Latitude</label>
                                            <input type="number" class="form-control" id="event-lat" step="0.000001" required>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label for="event-datetime" class="form-label">Date & Time</label>
                                            <input type="datetime-local" class="form-control" id="event-datetime" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="event-price" class="form-label">Price ($)</label>
                                            <input type="number" class="form-control" id="event-price" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="event-seats" class="form-label">Seats Available</label>
                                        <input type="number" class="form-control" id="event-seats" min="1" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Create Event</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Events List</h5>
                            </div>
                            <div class="card-body">
                                <div id="events-list">
                                    <p class="text-muted">Loading events...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Text Search Tab -->
            <div class="tab-pane fade" id="search" role="tabpanel">
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>Text Search</h5>
                            </div>
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="search-query" placeholder="Search events...">
                                    <button class="btn btn-outline-secondary" type="button" id="search-btn">Search</button>
                                </div>
                                <div id="search-results">
                                    <p class="text-muted">Enter a search term to find events</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nearby (Geo) Tab -->
            <div class="tab-pane fade" id="nearby" role="tabpanel">
                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>Search Controls</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="nearby-lng" class="form-label">Longitude</label>
                                    <input type="number" class="form-control" id="nearby-lng" step="0.000001" value="-74.0060">
                                </div>
                                <div class="mb-3">
                                    <label for="nearby-lat" class="form-label">Latitude</label>
                                    <input type="number" class="form-control" id="nearby-lat" step="0.000001" value="40.7128">
                                </div>
                                <div class="mb-3">
                                    <label for="nearby-radius" class="form-label">Radius (km)</label>
                                    <input type="range" class="form-range" id="nearby-radius" min="1" max="50" value="10">
                                    <div class="d-flex justify-content-between">
                                        <small>1km</small>
                                        <small id="radius-value">10km</small>
                                        <small>50km</small>
                                    </div>
                                </div>
                                <button class="btn btn-primary" id="find-nearby-btn">Find Nearby Events</button>
                                <button class="btn btn-outline-secondary" id="use-current-location">Use Current Location</button>
                            </div>
                        </div>
                        <div class="card mt-3">
                            <div class="card-header">
                                <h5>Nearby Events</h5>
                            </div>
                            <div class="card-body">
                                <div id="nearby-events-list">
                                    <p class="text-muted">Click "Find Nearby Events" to search</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5>Map View</h5>
                            </div>
                            <div class="card-body">
                                <div id="map" style="height: 500px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="tab-pane fade" id="analytics" role="tabpanel">
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Top Venues</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary mb-3" id="load-top-venues">Load Top Venues</button>
                                <div id="top-venues-list">
                                    <p class="text-muted">Click to load data</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Sales by Month</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary mb-3" id="load-sales-data">Load Sales Data</button>
                                <div id="sales-data">
                                    <p class="text-muted">Click to load data</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>General Statistics</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary mb-3" id="load-stats">Load Statistics</button>
                                <div id="general-stats">
                                    <p class="text-muted">Click to load data</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Tab -->
            <div class="tab-pane fade" id="perf" role="tabpanel">
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Query Performance</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="query-select" class="form-label">Select Query</label>
                                    <select class="form-select" id="query-select">
                                        <option value="">Choose a query...</option>
                                        <option value="text_search">Text Search</option>
                                        <option value="geo_nearby">Geospatial Nearby</option>
                                        <option value="venue_events">Venue Events</option>
                                        <option value="user_tickets">User Tickets</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary" id="explain-query-btn">Explain Query</button>
                                <div id="query-results" class="mt-3">
                                    <p class="text-muted">Select a query to analyze</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Index Information</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary mb-3" id="load-indexes">Load Indexes</button>
                                <div id="indexes-info">
                                    <p class="text-muted">Click to load index information</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div class="tab-pane fade" id="txn" role="tabpanel">
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Buy Ticket</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="ticket-event" class="form-label">Select Event</label>
                                    <select class="form-select" id="ticket-event">
                                        <option value="">Choose an event...</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="ticket-user" class="form-label">Select User</label>
                                    <select class="form-select" id="ticket-user">
                                        <option value="">Choose a user...</option>
                                    </select>
                                </div>
                                <button class="btn btn-success" id="buy-ticket-btn">Buy Ticket</button>
                                <div id="ticket-result" class="mt-3">
                                    <p class="text-muted">Select event and user to purchase ticket</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Transaction Demo</h5>
                            </div>
                            <div class="card-body">
                                <p>This demonstrates MongoDB transactions for ticket purchasing:</p>
                                <ul>
                                    <li>Checks if event has available seats</li>
                                    <li>Decrements seat count atomically</li>
                                    <li>Creates ticket record</li>
                                    <li>Rolls back on any failure</li>
                                </ul>
                                <button class="btn btn-outline-primary" id="run-txn-demo">Run Demo</button>
                                <div id="txn-demo-result" class="mt-3">
                                    <p class="text-muted">Click to run transaction demo</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
